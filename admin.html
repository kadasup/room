<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>一斗夢包棟民宿 | 後台（API版）</title>
  <style>
    :root{
      --bg:#f7f8fa; --fg:#222; --muted:#666; --brand:#1363df; --brand-600:#0f57c5;
      --ok:#c8e6c9; --bad:#ffcdd2; --pink:#fff8f8;
      --today:#fff8d6;
      --border:#dcdcdc; --sticky:#ffffffee;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",Arial,Helvetica,sans-serif;
      margin:24px;
      background:var(--bg);
      color:var(--fg);
    }
    h2{margin:6px 0 12px;text-align:center}

    .wrap{max-width:1100px;margin:0 auto}
    .controls{
      display:grid;
      grid-template-columns:repeat(7,auto);
      gap:8px;
      align-items:center;
      background:#fff;
      padding:12px;
      border:1px solid var(--border);
      border-radius:12px;
      margin-bottom:12px;
      box-shadow:0 1px 2px rgba(0,0,0,.04)
    }
    label{display:flex;gap:8px;align-items:center;color:var(--muted)}
    input[type="month"],select{
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff
    }
    button{
      padding:10px 14px;
      background:var(--brand);
      border:none;
      color:#fff;
      border-radius:10px;
      cursor:pointer;
      font-weight:600
    }
    button:hover{background:var(--brand-600)}
    .secondary{background:#e9eefb;color:#0f2d62}
    .legend{
      display:flex;
      gap:12px;
      align-items:center;
      font-size:14px;
      color:#444;
      margin:6px 0 14px
    }
    .dot{
      width:14px;
      height:14px;
      border-radius:4px;
      display:inline-block;
      border:1px solid var(--border);
      margin-right:6px
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px
    }
    .calendar{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      overflow:hidden
    }
    .cal-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      background:var(--sticky);
      position:sticky;
      top:0;
      z-index:1
    }
    .cal-title{font-weight:700}

    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{
      border-bottom:1px solid var(--border);
      padding:8px 6px;
      text-align:center
    }
    thead th{
      font-size:12px;
      color:#666;
      background:#fafafa;
      position:sticky;
      top:48px;
      z-index:1
    }

    .day{
      border-left:1px solid var(--border);
      min-height:52px;
      vertical-align:top;
      position:relative;
      background:#fff;
      cursor:pointer
    }
    .day:first-child{border-left:none}
    .dateNo{
      position:absolute;
      left:6px;
      top:6px;
      font-size:12px;
      color:#555;
      z-index:2
    }

    .state{
      margin-top:22px;
      display:inline-block;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid var(--border);
      font-weight:600;
      line-height:1.1;
    }
    .full{background:var(--bad)}
    .free{background:var(--ok)}

    /* 今天樣式 */
    .is-today{background:var(--today)}
    .today-dot{
      position:absolute;
      right:6px;
      top:6px;
      width:8px;
      height:8px;
      border-radius:50%;
      background:#e53935;
      box-shadow:0 0 0 2px #fff
    }

    .weekend{background:var(--pink)}
    .muted{color:#bbb}
    .past{background:#f3f3f3}

    .footer{
      margin-top:12px;
      font-size:13px;
      color:#555;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px
    }
    .notice{color:#888;max-width:580px}
    .chip{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#eef2ff;
      font-size:12px
    }
    .chip.muted{background:#f3f4f6;color:#666}
    .link{color:#0b5bd3;text-decoration:underline;cursor:pointer}
    .counts{font-variant-numeric:tabular-nums}

    @media(max-width:900px){
      body{margin:12px}
      .grid{grid-template-columns:1fr}
      .controls{
        grid-template-columns:1fr 1fr 1fr;
        row-gap:10px
      }
      .controls label{grid-column:1 / -1}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>房況後台（API 版）</h2>

    <div class="controls">
      <label>起始月份
        <input id="startMonth" type="month">
      </label>
      <button id="btnPrev3" class="secondary">← 前 3 個月</button>
      <button id="btnNext3" class="secondary">後 3 個月 →</button>
      <button id="btnReload" class="secondary">今天</button>
      <button id="btnSetSatFull" class="secondary">本月週六→已滿</button>
      <button id="btnSetAllFree" class="secondary">本月全部→可售</button>
      <span style="justify-self:end" id="lastSync" class="chip">未同步</span>
    </div>

    <div class="legend">
      <span><span class="dot" style="background:var(--ok)"></span>可售</span>
      <span><span class="dot" style="background:var(--bad)"></span>已滿</span>
      <span><span class="dot" style="background:var(--pink); border-color:#f4b4b4"></span>週末</span>
      <span class="chip"><span class="today-dot"></span> 今天（淡黃）</span>
      <span class="chip muted">灰色日期不可設定 &amp; 狀態不顯示</span>
    </div>

    <div id="calendars" class="grid" aria-label="三個月月曆"></div>

    <div class="footer">
      <div>API：<span id="apiBase" class="link"></span></div>
      <div class="notice">
        若遇「CORS/預檢」錯誤：請確認 Apps Script 網頁應用程式部署為「以 <b>我</b> 執行」且「<b>任何人</b> 可存取」，並確保本頁與前台使用同一個 /exec。
      </div>
    </div>
  </div>

  <script src="./calendar-core.js"></script>
  <script src="./admin.js"></script>
</body>
</html>
